<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Phantom by websudosuk</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Phantom</h1>
        <p>Asynchronous type-safe Scala DSL for Cassandra</p>

        <p class="view"><a href="https://github.com/websudosuk/phantom">View the Project on GitHub <small>websudosuk/phantom</small></a></p>


        <ul>
          <li><a href="https://github.com/websudosuk/phantom/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/websudosuk/phantom/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/websudosuk/phantom">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>phantom <a href="https://travis-ci.org/newzly/phantom"><img src="https://travis-ci.org/newzly/phantom.png?branch=develop" alt="Build Status"></a></p>

<h1></h1>

<p>Asynchronous Scala DSL for Cassandra</p>

<h1>
<a name="using-phantom" class="anchor" href="#using-phantom"><span class="octicon octicon-link"></span></a>Using phantom</h1>

<p>The current version is: <code>val phantomVersion = 0.8.0</code>.
Phantom is published to Maven Central and it's actively and avidly developed.</p>

<h1>
<a name="table-of-contents" class="anchor" href="#table-of-contents"><span class="octicon octicon-link"></span></a>Table of contents</h1>

<ol>
<li><a href="#issues-and-questions">Issues and questions</a></li>
    <li><a href="#integrating-phantom-in-your-project">Integrating phantom in your project</a></li>
    <li>
        <p>phantom columns</p>
        <ul>
<li><a href="#primitive-columns">Primitive columns</a></li>
            <li><a href="#optional-primitive-columns">Optional primitive columns</a></li>
            <li><a href="#collection-columns">Collection columns</a></li>
            <li>
                <p><a href="#indexing-columns">Indexing columns</a></p>
                <ul>
<li><a href="#partition-key">Partition Key</a></li>
                    <li><a href="#primary-key">Primary Key</a></li>
                    <li><a href="#secondary-key">Secondary Index Key</a></li>
                    <li><a href="#clustering-order">Clustering Order Key</a></li>
                </ul>
</li>
            <li><a href="#thrift-columns">Thrift columns</a></li>
        </ul>
</li>
    <li><a href="#data-modeling">Data modeling with phantom</a></li>
    <li>
        <p><a href="#querying-with-phantom">Querying with phantom</a></p>
        <ul>
<li><a href="#select-queries">SELECT queries</a></li>
            <li><a href="#partial-select-queries">Partial SELECT queries</a></li>
            <li><a href="#where-and-operators">WHERE and AND clause operators</a></li>
            <li><a href="#insert-queries">INSERT queries</a></li>
            <li><a href="#update-queries">UPDATE queries</a></li>
            <li><a href="#delete-queries">DELETE queries</a></li>
            <li><a href="#truncate-queries">TRUNCATE queries</a></li>
            <li><a href="#create-queries">CREATE queries</a></li>
            <li><a href="#alter-queries">ALTER queries</a></li>
            <li><a href="#common-query-methods">Common query methods</a></li>
        </ul>
</li>
    <li>
        <p>Basic query examples</p>
        <ul>
<li><a href="#scala-futures">Using Scala Futures to query</a></li>
            <li><a href="#scala-futures-examples">Examples with Scala Futures</a></li>
            <li><a href="#twitter-futures">Using Twitter Futures to query</a></li>
            <li><a href="#twitter-futures-examples">Examples with Twitter Futures</a></li>
        </ul>
</li>
    <li>
        <p><a href="#collections-and-operators">Collection operators</a></p>
        <ul>
<li><a href="#list-operators">List operators</a></li>
            <li><a href="#set-operators">Set operators</a></li>
            <li><a href="#map-operators">Map operators</a></li>
        </ul>
</li>
    <li><a href="#automated-schema-generation">Automated schema generation</a></li>
    <li>
        <p>Cassandra indexing</p>
        <ul>
<li><a href="#partition-tokens">Using partition tokens</a></li>
            <li><a href="#partition-token-operators">Partition token operators</a></li>
            <li><a href="#compound-keys">Compound Keys</a></li>
            <li><a href="#composite-keys">Composite Keys</a></li>
            <li><a href="#time-series">Cassandra Time Series and ClusteringOrder</a></li>
            <li><a href="#secondary-keys">Secondary Keys</a></li>
        </ul>
</li>
    <li><a href="#async-iterators">Asynchronous iterators</a></li>
    <li>
        <p>Batch statements</p>
        <ul>
<li><a href="#logged-batch-statements">LOGGED Batch statements</a></li>
            <li><a href="#counter-batch-statements">COUNTER Batch statements</a></li>
            <li><a href="#&lt;a%20id=">UNLOGGED Batch statements</a></li>
        </ul>
</li>
    <li><a href="#thrift-integration">Thrift integration</a></li>
    <li><a href="#running-tests">Running the tests locally</a></li>
    <li>
        <p><a href="#contributors">Contributing to phantom</a></p>
        <ul>
<li><a href="#using-gitflow">Using GitFlow as a branching model</a></li>
            <li><a href="#scala-style-guidelines">Scala style guidelines for contributions</a></li>
            <li>Using the testing utilities to write tests</li>
        </ul>
</li>
<li><a href="#copyright">Copyright</a></li>
</ol><h1>
<a name="issues-and-questions" class="anchor" href="#issues-and-questions"><span class="octicon octicon-link"></span></a>Issues and questions</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>We love Cassandra to bits and use it in every bit our stack. phantom makes it super trivial for Scala users to embrace Cassandra.</p>

<p>Cassandra is highly scalable and it's by far the most powerful database technology available, open source or otherwise.</p>

<p>Phantom is built on top of the <a href="https://github.com/datastax/java-driver">Datastax Java Driver</a>, which does most of the heavy lifting. </p>

<p>If you're completely new to Cassandra, a much better place to start is the <a href="http://www.datastax.com/documentation/getting_started/doc/getting_started/gettingStartedIntro_r.html">Datastax Introduction to Cassandra</a></p>

<p>We are very happy to help implement missing features in phantom, answer questions about phantom, and occasionally help you out with Cassandra questions, although do note we're a bit short staffed!</p>

<p>You can get in touch via the <a href="https://groups.google.com/forum/#!forum/newzly-phantom">newzly-phantom</a> Google Group.</p>

<h1>
<a name="integrating-phantom-in-your-project" class="anchor" href="#integrating-phantom-in-your-project"><span class="octicon octicon-link"></span></a>Integrating phantom in your project</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>For most things, all you need is <code>phantom-dsl</code>. Read through for information on other modules.</p>

<div class="highlight highlight-scala"><pre><span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"com.newzly"</span>  <span class="o">%%</span> <span class="s">"phantom-dsl"</span>                   <span class="o">%</span> <span class="n">phantomVersion</span>
<span class="o">)</span>
</pre></div>

<p>The full list of available modules is:</p>

<div class="highlight highlight-scala"><pre><span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"com.newzly"</span>  <span class="o">%%</span> <span class="s">"phantom-dsl"</span>                   <span class="o">%</span> <span class="n">phantomVersion</span><span class="o">,</span>
  <span class="s">"com.newzly"</span>  <span class="o">%%</span> <span class="s">"phantom-cassandra-unit"</span>        <span class="o">%</span> <span class="n">phantomVersion</span><span class="o">,</span>
  <span class="s">"com.newzly"</span>  <span class="o">%%</span> <span class="s">"phantom-example"</span>               <span class="o">%</span> <span class="n">phantomVersion</span><span class="o">,</span>
  <span class="s">"com.newzly"</span>  <span class="o">%%</span> <span class="s">"phantom-thrift"</span>                <span class="o">%</span> <span class="n">phantomVersion</span><span class="o">,</span>
  <span class="s">"com.newzly"</span>  <span class="o">%%</span> <span class="s">"phantom-test"</span>                  <span class="o">%</span> <span class="n">phantomVersion</span>
<span class="o">)</span>
</pre></div>

<h1>
<a name="primitive-columns" class="anchor" href="#primitive-columns"><span class="octicon octicon-link"></span></a>Primitive columns</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>This is the list of available columns and how they map to C* data types.
This also includes the newly introduced <code>static</code> columns in C* 2.0.6.</p>

<p>The type of a static column can be any of the allowed primitive Cassandra types.
phantom won't let you mixin a non-primitive via implicit magic.</p>

<table>
<thead><tr>
<th>phantom columns</th>
<th>Java/Scala type</th>
<th>Cassandra type</th>
</tr></thead>
<tbody>
<tr>
<td>BigDecimalColumn</td>
<td>scala.math.BigDecimal</td>
<td>decimal</td>
</tr>
<tr>
<td>BigIntColumn</td>
<td>scala.math.BigInt</td>
<td>varint</td>
</tr>
<tr>
<td>BooleanColumn</td>
<td>scala.Boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>DateColumn</td>
<td>java.util.Date</td>
<td>timestamp</td>
</tr>
<tr>
<td>DateTimeColumn</td>
<td>org.joda.time.DateTime</td>
<td>timestamp</td>
</tr>
<tr>
<td>DoubleColumn</td>
<td>scala.Double</td>
<td>double</td>
</tr>
<tr>
<td>FloatColumn</td>
<td>scala.Float</td>
<td>float</td>
</tr>
<tr>
<td>IntColumn</td>
<td>scala.Int</td>
<td>int</td>
</tr>
<tr>
<td>InetAddressColumn</td>
<td>java.net.InetAddress</td>
<td>inet</td>
</tr>
<tr>
<td>LongColumn</td>
<td>scala.Long</td>
<td>long</td>
</tr>
<tr>
<td>StringColumn</td>
<td>java.lang.String</td>
<td>text</td>
</tr>
<tr>
<td>UUIDColumn</td>
<td>java.util.UUID</td>
<td>uuid</td>
</tr>
<tr>
<td>TimeUUIDColumn</td>
<td>java.util.UUID</td>
<td>timeuuid</td>
</tr>
<tr>
<td>CounterColumn</td>
<td>scala.Long</td>
<td>counter</td>
</tr>
<tr>
<td>StaticColumn&lt;type&gt;</td>
<td>&lt;type&gt;</td>
<td>type static</td>
</tr>
</tbody>
</table><h1>
<a name="optional-primitive-columns" class="anchor" href="#optional-primitive-columns"><span class="octicon octicon-link"></span></a>Optional primitive columns</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Optional columns allow you to set a column to a <code>null</code> or a <code>None</code>. Use them when you really want something to be optional.
The outcome is that instead of a <code>T</code> you get an <code>Option[T]</code> and you can <code>match, fold, flatMap, map</code> on a <code>None</code>.</p>

<p>The <code>Optional</code> part is handled at a DSL level, it's not translated to Cassandra in any way.</p>

<table>
<thead><tr>
<th>phantom columns</th>
<th>Java/Scala type</th>
<th>Cassandra columns</th>
</tr></thead>
<tbody>
<tr>
<td>OptionalBigDecimalColumn</td>
<td>Option[scala.math.BigDecimal]</td>
<td>decimal</td>
</tr>
<tr>
<td>OptionalBigIntColumn</td>
<td>Option[scala.math.BigInt]</td>
<td>varint</td>
</tr>
<tr>
<td>OptionalBooleanColumn</td>
<td>Option[scala.Boolean]</td>
<td>boolean</td>
</tr>
<tr>
<td>OptionalDateColumn</td>
<td>Option[java.util.Date]</td>
<td>timestamp</td>
</tr>
<tr>
<td>OptionalDateTimeColumn</td>
<td>Option[org.joda.time.DateTime]</td>
<td>timestamp</td>
</tr>
<tr>
<td>OptionalDoubleColumn</td>
<td>Option[scala.Double]</td>
<td>double</td>
</tr>
<tr>
<td>OptionalFloatColumn</td>
<td>Option[scala.Float]</td>
<td>float</td>
</tr>
<tr>
<td>OptionalIntColumn</td>
<td>Option[scala.Int]</td>
<td>int</td>
</tr>
<tr>
<td>OptionalInetAddressColumn</td>
<td>Option[java.net.InetAddress]</td>
<td>inet</td>
</tr>
<tr>
<td>OptionalLongColumn</td>
<td>Option[Long]</td>
<td>long</td>
</tr>
<tr>
<td>OptionalStringColumn</td>
<td>Option[java.lang.String]</td>
<td>text</td>
</tr>
<tr>
<td>OptionalUUIDColumn</td>
<td>Option[java.util.UUID]</td>
<td>uuid</td>
</tr>
<tr>
<td>OptionalTimeUUID</td>
<td>Option[java.util.UUID]</td>
<td>timeuuid</td>
</tr>
</tbody>
</table><h1>
<a name="collection-columns" class="anchor" href="#collection-columns"><span class="octicon octicon-link"></span></a>Collection columns</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Cassandra collections do not allow custom data types. Storing JSON as a string is possible, but it's still a <code>text</code> column as far as Cassandra is concerned.
The <code>type</code> in the below example is always a default C* type.</p>

<table>
<thead><tr>
<th>phantom columns</th>
<th>Cassandra columns</th>
</tr></thead>
<tbody>
<tr>
<td>ListColumn.&lt;type&gt;</td>
<td>list&lt;type&gt;</td>
</tr>
<tr>
<td>SetColumn.&lt;type&gt;</td>
<td>set&lt;type&gt;</td>
</tr>
<tr>
<td>MapColumn.&lt;type, type&gt;</td>
<td>map&lt;type, type&gt;</td>
</tr>
</tbody>
</table><h1>
<a name="indexing-columns" class="anchor" href="#indexing-columns"><span class="octicon octicon-link"></span></a>Indexing columns</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>phantom uses a specific set of traits to enforce more advanced Cassandra limitations and schema rules at compile time.</p>

<h1>
<a name="partitionkeyt" class="anchor" href="#partitionkeyt"><span class="octicon octicon-link"></span></a>PartitionKey[T]</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>This is the default partitioning key of the table, telling Cassandra how to divide data into partitions and store them accordingly.
You must define at least one partition key for a table. Phantom will gently remind you of this with a fatal error.</p>

<p>If you use a single partition key, the <code>PartitionKey</code> will always be the first <code>PrimaryKey</code> in the schema.</p>

<p>It looks like this in CQL: <code>PRIMARY_KEY(your_partition_key, primary_key_1, primary_key_2)</code>.</p>

<p>Using more than one <code>PartitionKey[T]</code> in your schema definition will output a Composite Key in Cassandra.
<code>PRIMARY_KEY((your_partition_key_1, your_partition_key2), primary_key_1, primary_key_2)</code>.</p>

<h1>
<a name="primarykeyt" class="anchor" href="#primarykeyt"><span class="octicon octicon-link"></span></a>PrimaryKey[T]</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>As it's name says, using this will mark a column as <code>PrimaryKey</code>. Using multiple values will result in a Compound Value.
The first <code>PrimaryKey</code> is used to partition data. phantom will force you to always define a <code>PartitionKey</code> so you don't forget
about how your data is partitioned. We also use this DSL restriction because we hope to do more clever things with it in the future.</p>

<p>A compound key in C* looks like this:
<code>PRIMARY_KEY(primary_key, primary_key_1, primary_key_2)</code>.</p>

<p>Before you add too many of these, remember they all have to go into a <code>where</code> clause.
You can only query with a full primary key, even if it's compound. phantom can't yet give you a compile time error for this, but Cassandra will give you a runtime one.</p>

<h1>
<a name="index" class="anchor" href="#index"><span class="octicon octicon-link"></span></a>Index</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>This is a SecondaryIndex in Cassandra. It can help you enable querying really fast, but it's not exactly high performance.
It's generally best to avoid it, we implemented it to show off what good guys we are.</p>

<p>When you mix in <code>Index[T]</code> on a column, phantom will let you use it in a <code>where</code> clause.
However, don't forget to <code>allowFiltering</code> for such queries, otherwise C* will give you an error.</p>

<h1>
<a name="clusteringorder" class="anchor" href="#clusteringorder"><span class="octicon octicon-link"></span></a>ClusteringOrder</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>This can be used with either <code>java.util.Date</code> or <code>org.joda.time.DateTime</code>. It tells Cassandra to store records in a certain order based on this field.</p>

<p>An example might be: <code>object timestamp extends DateTimeColumn(this) with ClusteringOrder[DateTime] with Ascending</code>
To fully define a clustering column, you MUST also mixin either <code>Ascending</code> or <code>Descending</code> to indicate the sorting order.</p>

<h1>
<a name="thrift-columns" class="anchor" href="#thrift-columns"><span class="octicon octicon-link"></span></a>Thrift Columns</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>These columns are especially useful if you are building Thrift services. They are deeply integrated with Twitter Scrooge and relevant to the Twitter ecosystem(Finagle, Zipkin, Storm etc)
They are available via the <code>phantom-thrift</code> module and you need to <code>import com.newzly.phantom.thrift.Implicits._</code> to get them.</p>

<p>In the below scenario, the C* type is always text and the type you need to pass to the column is a Thrift struct, specifically <code>com.twitter.scrooge.ThriftStruct</code>.
phantom will use a <code>CompactThriftSerializer</code>, store the record as a binary string and then reparse it on fetch.</p>

<p>Thrift serialization and de-serialization is extremely fast, so you don't need to worry about speed or performance overhead.
You generally use these to store collections(small number of items), not big things.</p>

<table>
<thead><tr>
<th>phantom columns</th>
<th>Cassandra columns</th>
</tr></thead>
<tbody>
<tr>
<td>ThriftColumn.&lt;type&gt;</td>
<td>text</td>
</tr>
<tr>
<td>ThriftListColumn.&lt;type&gt;</td>
<td>list&lt;text&gt;</td>
</tr>
<tr>
<td>ThriftSetColumn.&lt;type&gt;</td>
<td>set&lt;text&gt;</td>
</tr>
<tr>
<td>ThriftMapColumn.&lt;type, type&gt;</td>
<td>map&lt;text, text&gt;</td>
</tr>
</tbody>
</table><h1>
<a name="data-modeling-with-phantom" class="anchor" href="#data-modeling-with-phantom"><span class="octicon octicon-link"></span></a>Data modeling with phantom</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">java.util.</span><span class="o">{</span> <span class="nc">Date</span><span class="o">,</span> <span class="nc">UUID</span> <span class="o">}</span>
<span class="k">import</span> <span class="nn">com.datastax.driver.core.Row</span>
<span class="k">import</span> <span class="nn">com.newzly.phantom.sample.ExampleModel</span>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">ExampleModel</span> <span class="o">(</span>
  <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">props</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">],</span>
  <span class="n">timestamp</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
  <span class="n">test</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
<span class="o">)</span>

<span class="k">sealed</span> <span class="k">class</span> <span class="nc">ExampleRecord</span> <span class="k">extends</span> <span class="nc">CassandraTable</span><span class="o">[</span><span class="kt">ExampleRecord</span>, <span class="kt">ExampleModel</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">object</span> <span class="nc">id</span> <span class="k">extends</span> <span class="nc">UUIDColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PartitionKey</span><span class="o">[</span><span class="kt">UUID</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">timestamp</span> <span class="k">extends</span> <span class="nc">DateTimeColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">ClusteringOrder</span> <span class="k">with</span> <span class="nc">Ascending</span>
  <span class="k">object</span> <span class="nc">name</span> <span class="k">extends</span> <span class="nc">StringColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">props</span> <span class="k">extends</span> <span class="nc">MapColumn</span><span class="o">[</span><span class="kt">ExampleRecord</span>, <span class="kt">ExampleModel</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">test</span> <span class="k">extends</span> <span class="nc">OptionalIntColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">fromRow</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Row</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExampleModel</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ExampleModel</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">name</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">props</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">timestamp</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">test</span><span class="o">(</span><span class="n">row</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></div>

<h1>
<a name="querying-with-phantom" class="anchor" href="#querying-with-phantom"><span class="octicon octicon-link"></span></a>Querying with Phantom</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>The query syntax is inspired by the Foursquare Rogue library and aims to replicate CQL 3 as much as possible.</p>

<p>Phantom works with both Scala Futures and Twitter Futures as first class citizens.</p>

<h1>
<a name="select-queries" class="anchor" href="#select-queries"><span class="octicon octicon-link"></span></a>"Select" queries</h1>

<p><a href="#table-of-contents">back to top</a></p>

<table>
<thead><tr>
<th>Method name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>where</code></td>
<td>The <code>WHERE</code> clause in CQL</td>
</tr>
<tr>
<td><code>and</code></td>
<td>Chains several clauses, creating a <code>WHERE ... AND</code> query</td>
</tr>
<tr>
<td><code>orderBy</code></td>
<td>Adds an <code>ORDER_BY column_name</code> to the query</td>
</tr>
<tr>
<td><code>allowFiltering</code></td>
<td>Allows Cassandra to filter records in memory. This is an expensive operation.</td>
</tr>
<tr>
<td><code>useConsistencyLevel</code></td>
<td>Sets the consistency level to use.</td>
</tr>
<tr>
<td><code>setFetchSize</code></td>
<td>Sets the maximum number of records to retrieve. Default is 10000</td>
</tr>
<tr>
<td><code>limit</code></td>
<td>Sets the exact number of records to retrieve.</td>
</tr>
</tbody>
</table><p>Select queries are very straightforward and enforce most limitations at compile time.</p>

<h1>
<a name="where-and-and-clause-operators" class="anchor" href="#where-and-and-clause-operators"><span class="octicon octicon-link"></span></a>
<code>where</code> and <code>and</code> clause operators</h1>

<p><a href="#table-of-contents">back to top</a></p>

<table>
<thead><tr>
<th>Operator name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td>eqs</td>
<td>The "equals" operator. Will match if the objects are equal</td>
</tr>
<tr>
<td>in</td>
<td>The "in" operator. Will match if the object is found the list of arguments</td>
</tr>
<tr>
<td>gt</td>
<td>The "greater than" operator. Will match a the record is greater than the argument and exists</td>
</tr>
<tr>
<td>gte</td>
<td>The "greater than or equals" operator. Will match a the record is greater than the argument and exists</td>
</tr>
<tr>
<td>lt</td>
<td>The "lower than" operator. Will match a the record that is less than the argument and exists</td>
</tr>
<tr>
<td>lte</td>
<td>The "lower than or equals" operator. Will match a the record that is less than the argument and exists</td>
</tr>
</tbody>
</table><h1>
<a name="partial-selects" class="anchor" href="#partial-selects"><span class="octicon octicon-link"></span></a>Partial selects</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>All partial select queries will return Tuples and are therefore limited to 22 fields.
We haven't yet bothered to add more than 10 fields in the select, but you can always do a Pull Request.
The file you are looking for is <a href="https://github.com/newzly/phantom/blob/develop/phantom-dsl/src/main/scala/com/newzly/phantom/SelectTable.scala">here</a>.
The 22 field limitation will change in Scala 2.11 and phantom will be updated once cross version compilation is enabled.</p>

<div class="highlight highlight-scala"><pre>  <span class="k">def</span> <span class="n">getNameById</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">one</span><span class="o">()</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">getNameAndPropsById</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">(</span><span class="kt">String</span>, <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">])]</span> <span class="o">{</span>
    <span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">props</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">one</span><span class="o">()</span>
  <span class="o">}</span>
</pre></div>

<h1>
<a name="insert-queries" class="anchor" href="#insert-queries"><span class="octicon octicon-link"></span></a>"Insert" queries</h1>

<p><a href="#table-of-contents">back to top</a></p>

<table>
<thead><tr>
<th>Method name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>value</code></td>
<td>A type safe Insert query builder. Throws an error for <code>null</code> values.</td>
</tr>
<tr>
<td><code>valueOrNull</code></td>
<td>This will accept a <code>null</code> without throwing an error.</td>
</tr>
<tr>
<td><code>useConsistencyLevel</code></td>
<td>Sets the consistency level to use.</td>
</tr>
<tr>
<td><code>ttl</code></td>
<td>Sets the "Time-To-Live" for the record.</td>
</tr>
</tbody>
</table><h1>
<a name="update-queries" class="anchor" href="#update-queries"><span class="octicon octicon-link"></span></a>"Update" queries</h1>

<p><a href="#table-of-contents">back to top</a></p>

<table>
<thead><tr>
<th>Method name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>where</code></td>
<td>The <code>WHERE</code> clause in CQL</td>
</tr>
<tr>
<td><code>and</code></td>
<td>Chains several clauses, creating a <code>WHERE ... AND</code> query</td>
</tr>
<tr>
<td><code>modify</code></td>
<td>The actual update query builder</td>
</tr>
<tr>
<td><code>useConsistencyLevel</code></td>
<td>Sets the consistency level to use.</td>
</tr>
<tr>
<td><code>onflyIf</code></td>
<td>Addition update condition. Used on non-primary columns</td>
</tr>
</tbody>
</table><h1>
<a name="delete-queries" class="anchor" href="#delete-queries"><span class="octicon octicon-link"></span></a>"Delete" queries</h1>

<p><a href="#table-of-contents">back to top</a></p>

<table>
<thead><tr>
<th>Method name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>where</code></td>
<td>The <code>WHERE</code> clause in CQL</td>
</tr>
<tr>
<td><code>useConsistencyLevel</code></td>
<td>Sets the consistency level to use.</td>
</tr>
</tbody>
</table><h1>
<a name="common-query-methods" class="anchor" href="#common-query-methods"><span class="octicon octicon-link"></span></a>Common query methods</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>The full list can be found in <a href="https://github.com/newzly/phantom/blob/develop/phantom-dsl/src/main/scala/com/newzly/phantom/query/CQLQuery.scala">CQLQuery.scala</a>.</p>

<table>
<thead><tr>
<th>Method name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>tracing_=</code></td>
<td>The Cassandra utility method. Enables or disables tracing.</td>
</tr>
<tr>
<td><code>queryString</code></td>
<td>Get the output CQL 3 query of a phantom query.</td>
</tr>
<tr>
<td><code>consistencyLevel</code></td>
<td>Retrieves the consistency level in use.</td>
</tr>
<tr>
<td><code>consistencyLevel_=</code></td>
<td>Sets the consistency level to use.</td>
</tr>
<tr>
<td><code>retryPolicy</code></td>
<td>Retrieves the RetryPolicy in use.</td>
</tr>
<tr>
<td><code>retryPolicy_=</code></td>
<td>Sets the RetryPolicy to use.</td>
</tr>
<tr>
<td><code>serialConsistencyLevel</code></td>
<td>Retrieves the serial consistency level in use.</td>
</tr>
<tr>
<td><code>serialConsistencyLevel_=</code></td>
<td>Sets the serial consistency level to use.</td>
</tr>
<tr>
<td><code>forceNoValues_=</code></td>
<td>Sets the serial consistency level to use.</td>
</tr>
<tr>
<td><code>routingKey</code></td>
<td>Retrieves the Routing Key as a ByteBuffer.</td>
</tr>
</tbody>
</table><h1>
<a name="scala-futures" class="anchor" href="#scala-futures"><span class="octicon octicon-link"></span></a>Scala Futures</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">one</span><span class="o">()</span> <span class="c1">// When you only want to select one record</span>
<span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">eqs</span> <span class="n">name</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">setTo</span> <span class="s">"someOtherName"</span><span class="o">).</span><span class="n">future</span><span class="o">()</span> <span class="c1">// When you don't care about the return type.</span>
<span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">fetchEnumerator</span> <span class="c1">// when you need an Enumerator</span>
<span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">fetch</span> <span class="c1">// When you want to fetch a Seq[Record]</span>
</pre></div>

<h1>
<a name="examples-with-scala-futures" class="anchor" href="#examples-with-scala-futures"><span class="octicon octicon-link"></span></a>Examples with Scala Futures</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>

<span class="k">object</span> <span class="nc">ExampleRecord</span> <span class="k">extends</span> <span class="nc">ExampleRecord</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">tableName</span> <span class="k">=</span> <span class="s">"examplerecord"</span>

  <span class="c1">// now define a session, a normal Datastax cluster connection</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">session</span> <span class="k">=</span> <span class="nc">SomeCassandraClient</span><span class="o">.</span><span class="n">session</span><span class="o">;</span>

  <span class="k">def</span> <span class="n">getRecordsByName</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">ExampleModel</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">eqs</span> <span class="n">name</span><span class="o">).</span><span class="n">fetch</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">getOneRecordByName</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">someId</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">ExampleModel</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">eqs</span> <span class="n">name</span><span class="o">).</span><span class="n">and</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">one</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h1>
<a name="twitter-futures" class="anchor" href="#twitter-futures"><span class="octicon octicon-link"></span></a>Twitter Futures</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">get</span><span class="o">()</span> <span class="c1">// When you only want to select one record</span>
<span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">eqs</span> <span class="n">name</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">setTo</span> <span class="s">"someOtherName"</span><span class="o">).</span><span class="n">execute</span><span class="o">()</span> <span class="c1">// When you don't care about the return type.</span>
<span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">enumerate</span> <span class="c1">// when you need an Enumerator</span>
<span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">collect</span> <span class="c1">// When you want to fetch a Seq[Record]</span>
</pre></div>

<h1>
<a name="more-examples-with-twitter-futures" class="anchor" href="#more-examples-with-twitter-futures"><span class="octicon octicon-link"></span></a>More examples with Twitter Futures</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">com.twitter.util.Future</span>

<span class="k">object</span> <span class="nc">ExampleRecord</span> <span class="k">extends</span> <span class="nc">ExampleRecord</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">tableName</span> <span class="k">=</span> <span class="s">"examplerecord"</span>

  <span class="c1">// now define a session, a normal Datastax cluster connection</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">session</span> <span class="k">=</span> <span class="nc">SomeCassandraClient</span><span class="o">.</span><span class="n">session</span><span class="o">;</span>

  <span class="k">def</span> <span class="n">getRecordsByName</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">ExampleModel</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">eqs</span> <span class="n">name</span><span class="o">).</span><span class="n">collect</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">getOneRecordByName</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">someId</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">ExampleModel</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">eqs</span> <span class="n">name</span><span class="o">).</span><span class="n">and</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">get</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h1>
<a name="collections-and-operators" class="anchor" href="#collections-and-operators"><span class="octicon octicon-link"></span></a>Collections and operators</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Based on the above list of columns, phantom supports CQL 3 modify operations for CQL 3 collections: <code>list, set, map</code>.
All operators will be available in an update query, specifically:</p>

<p><code>ExampleRecord.update.where(_.id eqs someId).modify(_.someList $OPERATOR $args).future()</code>.</p>

<h1>
<a name="list-operators" class="anchor" href="#list-operators"><span class="octicon octicon-link"></span></a>List operators</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Examples in <a href="https://github.com/newzly/phantom/blob/develop/phantom-test/src/test/scala/com/newzly/phantom/dsl/crud/ListOperatorsTest.scala">ListOperatorsTest.scala</a>.</p>

<table>
<thead><tr>
<th>Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>prepend</code></td>
<td>Adds an item to the head of the list</td>
</tr>
<tr>
<td><code>prependAll</code></td>
<td>Adds multiple items to the head of the list</td>
</tr>
<tr>
<td><code>append</code></td>
<td>Adds an item to the tail of the list</td>
</tr>
<tr>
<td><code>appendAll</code></td>
<td>Adds multiple items to the tail of the list</td>
</tr>
<tr>
<td><code>discard</code></td>
<td>Removes the given item from the list.</td>
</tr>
<tr>
<td><code>discardAll</code></td>
<td>Removes all given items from the list.</td>
</tr>
<tr>
<td><code>setIdIx</code></td>
<td>Updates a specific index in the list</td>
</tr>
</tbody>
</table><h1>
<a name="set-operators" class="anchor" href="#set-operators"><span class="octicon octicon-link"></span></a>Set operators</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Sets have a better performance than lists, as the Cassandra documentation suggests.
Examples in <a href="https://github.com/newzly/phantom/blob/develop/phantom-test/src/test/scala/com/newzly/phantom/dsl/crud/SetOperationsTest.scala">SetOperationsTest.scala</a>.</p>

<table>
<thead><tr>
<th>Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>add</code></td>
<td>Adds an item to the tail of the set</td>
</tr>
<tr>
<td><code>addAll</code></td>
<td>Adds multiple items to the tail of the set</td>
</tr>
<tr>
<td><code>remove</code></td>
<td>Removes the given item from the set.</td>
</tr>
<tr>
<td><code>removeAll</code></td>
<td>Removes all given items from the set.</td>
</tr>
</tbody>
</table><h1>
<a name="map-operators" class="anchor" href="#map-operators"><span class="octicon octicon-link"></span></a>Map operators</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Both the key and value types of a Map must be Cassandra primitives.
Examples in <a href="https://github.com/newzly/phantom/blob/develop/phantom-test/src/test/scala/com/newzly/phantom/dsl/crud/MapOperationsTest.scala">MapOperationsTest.scala</a>:</p>

<table>
<thead><tr>
<th>Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>put</code></td>
<td>Adds an (key -&gt; value) pair to the map</td>
</tr>
<tr>
<td><code>putAll</code></td>
<td>Adds multiple (key -&gt; value) pairs to the map</td>
</tr>
</tbody>
</table><h1>
<a name="automated-schema-generation" class="anchor" href="#automated-schema-generation"><span class="octicon octicon-link"></span></a>Automated schema generation</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Replication strategies and more advanced features are not yet available in phantom, but CQL 3 Table schemas are  automatically generated from the Scala code. To create a schema in Cassandra from a table definition:</p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">scala.concurrent.Await</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">create</span><span class="o">().</span><span class="n">future</span><span class="o">(),</span> <span class="mi">5000</span> <span class="n">millis</span><span class="o">)</span>
</pre></div>

<p>Of course, you don't have to block unless you want to.</p>

<h1>
<a name="partition-tokens" class="anchor" href="#partition-tokens"><span class="octicon octicon-link"></span></a>Partition tokens</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">scala.concurrent.Await</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="k">sealed</span> <span class="k">class</span> <span class="nc">ExampleRecord2</span> <span class="k">extends</span> <span class="nc">CassandraTable</span><span class="o">[</span><span class="kt">ExampleRecord2</span>, <span class="kt">ExampleModel</span><span class="o">]</span> <span class="k">with</span> <span class="nc">LongOrderKey</span><span class="o">[</span><span class="kt">ExampleRecod2</span>, <span class="kt">ExampleRecord</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">object</span> <span class="nc">id</span> <span class="k">extends</span> <span class="nc">UUIDColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PartitionKey</span><span class="o">[</span><span class="kt">UUID</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">timestamp</span> <span class="k">extends</span> <span class="nc">DateTimeColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">name</span> <span class="k">extends</span> <span class="nc">StringColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">props</span> <span class="k">extends</span> <span class="nc">MapColumn</span><span class="o">[</span><span class="kt">ExampleRecord2</span>, <span class="kt">ExampleRecord</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">test</span> <span class="k">extends</span> <span class="nc">OptionalIntColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">fromRow</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Row</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExampleModel</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ExampleModel</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">name</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">props</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">timestamp</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">test</span><span class="o">(</span><span class="n">row</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>


<span class="k">val</span> <span class="n">orderedResult</span> <span class="k">=</span> <span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="nc">Articles</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">gtToken</span> <span class="n">one</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">id</span> <span class="o">).</span><span class="n">fetch</span><span class="o">,</span> <span class="mi">5000</span> <span class="n">millis</span><span class="o">)</span>

</pre></div>

<h1>
<a name="partitiontoken-operators" class="anchor" href="#partitiontoken-operators"><span class="octicon octicon-link"></span></a>PartitionToken operators</h1>

<p><a href="#table-of-contents">back to top</a></p>

<table>
<thead><tr>
<th>Operator name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td>eqsToken</td>
<td>The "equals" operator. Will match if the objects are equal</td>
</tr>
<tr>
<td>gtToken</td>
<td>The "greater than" operator. Will match a the record is greater than the argument</td>
</tr>
<tr>
<td>gteToken</td>
<td>The "greater than or equals" operator. Will match a the record is greater than the argument</td>
</tr>
<tr>
<td>ltToken</td>
<td>The "lower than" operator. Will match a the record that is less than the argument and exists</td>
</tr>
<tr>
<td>lteToken</td>
<td>The "lower than or equals" operator. Will match a the record that is less than the argument</td>
</tr>
</tbody>
</table><p>For more details on how to use Cassandra partition tokens, see <a href="https://github.com/newzly/phantom/blob/develop/phantom-test/src/test/scala/com/newzly/phantom/dsl/SkipRecordsByToken.scala">SkipRecordsByToken.scala</a></p>

<h1>
<a name="cassandra-time-series" class="anchor" href="#cassandra-time-series"><span class="octicon octicon-link"></span></a>Cassandra Time Series</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>phantom supports Cassandra Time Series with both <code>java.util.Date</code> and <code>org.joda.time.DateTime</code>. To use them, simply mixin <code>com.newzly.phantom.keys.ClusteringOrder</code> and either <code>Ascending</code> or <code>Descending</code>.</p>

<p>Restrictions are enforced at compile time.</p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="k">sealed</span> <span class="k">class</span> <span class="nc">ExampleRecord3</span> <span class="k">extends</span> <span class="nc">CassandraTable</span><span class="o">[</span><span class="kt">ExampleRecord3</span>, <span class="kt">ExampleModel</span><span class="o">]</span> <span class="k">with</span> <span class="nc">LongOrderKey</span><span class="o">[</span><span class="kt">ExampleRecod3</span>, <span class="kt">ExampleRecord</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">object</span> <span class="nc">id</span> <span class="k">extends</span> <span class="nc">UUIDColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PartitionKey</span><span class="o">[</span><span class="kt">UUID</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">timestamp</span> <span class="k">extends</span> <span class="nc">DateTimeColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">ClusteringOrder</span> <span class="k">with</span> <span class="nc">Ascending</span>
  <span class="k">object</span> <span class="nc">name</span> <span class="k">extends</span> <span class="nc">StringColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">props</span> <span class="k">extends</span> <span class="nc">MapColumn</span><span class="o">[</span><span class="kt">ExampleRecord2</span>, <span class="kt">ExampleRecord</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">test</span> <span class="k">extends</span> <span class="nc">OptionalIntColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">fromRow</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Row</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExampleModel</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ExampleModel</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">name</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">props</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">timestamp</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">test</span><span class="o">(</span><span class="n">row</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Automatic schema generation can do all the setup for you.</p>

<h1>
<a name="compound-keys" class="anchor" href="#compound-keys"><span class="octicon octicon-link"></span></a>Compound keys</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Phantom also supports using Compound keys out of the box. The schema can once again by auto-generated.</p>

<p>A table can have only one <code>PartitionKey</code> but several <code>PrimaryKey</code> definitions. Phantom will use these keys to build a compound value. Example scenario, with the compound key: <code>(id, timestamp, name)</code></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">org.joda.time.DateTime</span>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="k">sealed</span> <span class="k">class</span> <span class="nc">ExampleRecord3</span> <span class="k">extends</span> <span class="nc">CassandraTable</span><span class="o">[</span><span class="kt">ExampleRecord3</span>, <span class="kt">ExampleModel</span><span class="o">]</span> <span class="k">with</span> <span class="nc">LongOrderKey</span><span class="o">[</span><span class="kt">ExampleRecod3</span>, <span class="kt">ExampleRecord</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">object</span> <span class="nc">id</span> <span class="k">extends</span> <span class="nc">UUIDColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PartitionKey</span><span class="o">[</span><span class="kt">UUID</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">timestamp</span> <span class="k">extends</span> <span class="nc">DateTimeColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PrimaryKey</span><span class="o">[</span><span class="kt">DateTime</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">name</span> <span class="k">extends</span> <span class="nc">StringColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PrimaryKey</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">props</span> <span class="k">extends</span> <span class="nc">MapColumn</span><span class="o">[</span><span class="kt">ExampleRecord2</span>, <span class="kt">ExampleRecord</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">test</span> <span class="k">extends</span> <span class="nc">OptionalIntColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">fromRow</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Row</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExampleModel</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ExampleModel</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">name</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">props</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">timestamp</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">test</span><span class="o">(</span><span class="n">row</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h1>
<a name="cql-3-secondary-keys" class="anchor" href="#cql-3-secondary-keys"><span class="octicon octicon-link"></span></a>CQL 3 Secondary Keys</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>When you want to use a column in a <code>where</code> clause, you need an index on it. Cassandra data modeling is out of the scope of this writing, but phantom offers <code>com.newzly.phantom.keys.Index</code> to enable querying.</p>

<p>The CQL 3 schema for secondary indexes can also be auto-generated with <code>ExampleRecord4.create()</code>.</p>

<p><code>SELECT</code> is the only query you can perform with an <code>Index</code> column. This is a Cassandra limitation. The relevant tests are found <a href="https://github.com/newzly/phantom/blob/develop/phantom-test/src/test/scala/com/newzly/phantom/dsl/specialized/SecondaryIndexTest.scala">here</a>.</p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">java.util.UUID</span>
<span class="k">import</span> <span class="nn">org.joda.time.DateTime</span>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="k">sealed</span> <span class="k">class</span> <span class="nc">ExampleRecord4</span> <span class="k">extends</span> <span class="nc">CassandraTable</span><span class="o">[</span><span class="kt">ExampleRecord4</span>, <span class="kt">ExampleModel</span><span class="o">]</span> <span class="k">with</span> <span class="nc">LongOrderKey</span><span class="o">[</span><span class="kt">ExampleRecod4</span>, <span class="kt">ExampleRecord</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">object</span> <span class="nc">id</span> <span class="k">extends</span> <span class="nc">UUIDColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PartitionKey</span><span class="o">[</span><span class="kt">UUID</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">timestamp</span> <span class="k">extends</span> <span class="nc">DateTimeColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">Index</span><span class="o">[</span><span class="kt">DateTime</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">name</span> <span class="k">extends</span> <span class="nc">StringColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">Index</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">props</span> <span class="k">extends</span> <span class="nc">MapColumn</span><span class="o">[</span><span class="kt">ExampleRecord2</span>, <span class="kt">ExampleRecord</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">test</span> <span class="k">extends</span> <span class="nc">OptionalIntColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">fromRow</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Row</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExampleModel</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ExampleModel</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">name</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">props</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">timestamp</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">test</span><span class="o">(</span><span class="n">row</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h1>
<a name="asynchronous-iterators-for-large-record-sets" class="anchor" href="#asynchronous-iterators-for-large-record-sets"><span class="octicon octicon-link"></span></a>Asynchronous iterators for large record sets</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Phantom comes packed with CQL rows asynchronous lazy iterators to help you deal with billions of records.
phantom iterators are based on Play iterators with very lightweight integration.</p>

<p>The functionality is identical with respect to asynchronous, lazy behaviour and available methods.
For more on this, see this <a href="http://mandubian.com/2012/08/27/understanding-play2-iteratees-for-normal-humans/">Play tutorial</a></p>

<p>Usage is trivial. If you want to use <code>slice, take or drop</code> with iterators, the partitioner needs to be ordered.</p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">scala.concurrent.Await</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">org.joda.time.DateTime</span>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>


<span class="k">sealed</span> <span class="k">class</span> <span class="nc">ExampleRecord3</span> <span class="k">extends</span> <span class="nc">CassandraTable</span><span class="o">[</span><span class="kt">ExampleRecord3</span>, <span class="kt">ExampleModel</span><span class="o">]</span> <span class="k">with</span> <span class="nc">LongOrderKey</span><span class="o">[</span><span class="kt">ExampleRecord3</span>, <span class="kt">ExampleRecord</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">object</span> <span class="nc">id</span> <span class="k">extends</span> <span class="nc">UUIDColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PartitionKey</span><span class="o">[</span><span class="kt">UUID</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">timestamp</span> <span class="k">extends</span> <span class="nc">DateTimeColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PrimaryKey</span><span class="o">[</span><span class="kt">DateTime</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">name</span> <span class="k">extends</span> <span class="nc">StringColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="k">with</span> <span class="nc">PrimaryKey</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
  <span class="k">object</span> <span class="nc">props</span> <span class="k">extends</span> <span class="nc">MapColumn</span><span class="o">[</span><span class="kt">ExampleRecord2</span>, <span class="kt">ExampleRecord</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="k">this</span><span class="o">)</span>
  <span class="k">object</span> <span class="nc">test</span> <span class="k">extends</span> <span class="nc">OptionalIntColumn</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">fromRow</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Row</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExampleModel</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ExampleModel</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">name</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">props</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">timestamp</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">test</span><span class="o">(</span><span class="n">row</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">ExampleRecord3</span> <span class="k">extends</span> <span class="nc">ExampleRecord3</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">getRecords</span><span class="o">(</span><span class="n">start</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">limit</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Set</span><span class="o">[</span><span class="kt">ExampleModel</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">select</span><span class="o">.</span><span class="n">fetchEnumerator</span><span class="o">.</span><span class="n">slice</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">limit</span><span class="o">).</span><span class="n">collect</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></div>

<h1>
<a name="batch-statements" class="anchor" href="#batch-statements"><span class="octicon octicon-link"></span></a>Batch statements</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>phantom also brrings in support for batch statements. To use them, see <a href="https://github.com/newzly/phantom/blob/develop/phantom-test/src/test/scala/com/newzly/phantom/iteratee/IterateeBigTest.scala">IterateeBigTest.scala</a></p>

<p>We have tested with 10,000 statements per batch, and 1000 batches processed simulatenously. Before you run the test, beware that it takes ~40 minutes.</p>

<p>Batches use lazy iterators and daisy chain them to offer thread safe behaviour. They are not memory intensive and you can expect consistent processing speed even with 1 000 000 statements per batch.</p>

<p>Batches are immutable and adding a new record will result in a new Batch, just like most things Scala, so be careful to chain the calls.</p>

<p>phantom also supports COUNTER batch updates and UNLOGGED batch updates.</p>

<h1>
<a name="logged-batch-statements" class="anchor" href="#logged-batch-statements"><span class="octicon octicon-link"></span></a>LOGGED batch statements</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="nc">BatchStatement</span><span class="o">()</span>
    <span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">setTo</span> <span class="s">"blabla"</span><span class="o">))</span>
    <span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someOtherId</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">setTo</span> <span class="s">"blabla2"</span><span class="o">))</span>
    <span class="o">.</span><span class="n">future</span><span class="o">()</span>

</pre></div>

<h1>
<a name="counter-batch-statements" class="anchor" href="#counter-batch-statements"><span class="octicon octicon-link"></span></a>COUNTER batch statements</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="nc">CounterBatchStatement</span><span class="o">()</span>
    <span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">someCounter</span> <span class="n">increment</span> <span class="mi">500L</span><span class="o">))</span>
    <span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someOtherId</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">someCounter</span> <span class="n">decrement</span> <span class="mi">300L</span><span class="o">))</span>
    <span class="o">.</span><span class="n">future</span><span class="o">()</span>
</pre></div>

<h1>
<a name="unlogged-batch-statements" class="anchor" href="#unlogged-batch-statements"><span class="octicon octicon-link"></span></a>UNLOGGED batch statements</h1>

<p><a href="#table-of-contents">back to top</a></p>

<div class="highlight highlight-scala"><pre>
<span class="k">import</span> <span class="nn">com.newzly.phantom.Implicits._</span>

<span class="nc">UnloggedBatchStatement</span><span class="o">()</span>
    <span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someId</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">setTo</span> <span class="s">"blabla"</span><span class="o">))</span>
    <span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ExampleRecord</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="n">eqs</span> <span class="n">someOtherId</span><span class="o">).</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="n">setTo</span> <span class="s">"blabla2"</span><span class="o">))</span>
    <span class="o">.</span><span class="n">future</span><span class="o">()</span>

</pre></div>

<h1>
<a name="thrift-integration" class="anchor" href="#thrift-integration"><span class="octicon octicon-link"></span></a>Thrift integration</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>We use Apache Thrift extensively for our backend services. <code>phantom</code> is very easy to integrate with Thrift models and uses <code>Twitter Scrooge</code> to compile them. Thrift integration is optional and available via <code>"com.newzly" %% "phantom-thrift"  % phantomVersion</code>.</p>

<pre lang="thrift"><code>namespace java com.newzly.phantom.sample.ExampleModel

stuct ExampleModel {
  1: required i32 id,
  2: required string name,
  3: required Map&amp;lt;string, string&amp;gt; props,
  4: required i32 timestamp
  5: optional i32 test
}
</code></pre>

<h1>
<a name="running-the-tests-locally" class="anchor" href="#running-the-tests-locally"><span class="octicon octicon-link"></span></a>Running the tests locally</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>phantom uses Embedded Cassandra to run tests without a local Cassandra server running.
You need two terminals to run the tests, one for Embedded Cassandra and one for the actual tests.</p>

<div class="highlight highlight-scala"><pre><span class="n">sbt</span>
<span class="n">project</span> <span class="n">phantom</span><span class="o">-</span><span class="n">cassandra</span><span class="o">-</span><span class="n">unit</span>
<span class="n">run</span>
</pre></div>

<p>Then in a new terminal</p>

<div class="highlight highlight-scala"><pre><span class="n">sbt</span>
<span class="n">project</span> <span class="n">phantom</span><span class="o">-</span><span class="n">test</span>
<span class="n">test</span>
</pre></div>

<h1>
<a name="contributors" class="anchor" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Phantom was developed at newzly as an in-house project. All Cassandra integration at newzly goes through phantom.</p>

<ul>
<li>Flavian Alexandru <a href="mailto:flavian@newzly.com">flavian@newzly.com</a>(maintainer)</li>
<li>Tomasz Perek <a href="mailto:tomasz.perek@newzly.com">tomasz.perek@newzly.com</a>
</li>
<li>Viktor Taranenko (viktortnk)</li>
<li>Bartosz Jankiewicz (<a href="https://github.com/bjankie1" class="user-mention">@bjankie1</a>)</li>
<li>Eugene Zhulenev (<a href="https://github.com/ezhulenev" class="user-mention">@ezhulenev</a>)</li>
</ul><h1>
<a name="copyright" class="anchor" href="#copyright"><span class="octicon octicon-link"></span></a>Copyright</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Special thanks to Viktor Taranenko from WhiskLabs, who gave us the original idea.</p>

<p>Copyright 2013 WhiskLabs, Copyright 2013 - 2014 newzly.</p>

<h1>
<a name="contributing-to-phantom" class="anchor" href="#contributing-to-phantom"><span class="octicon octicon-link"></span></a>Contributing to phantom</h1>

<p><a href="#table-of-contents">back to top</a></p>

<p>Contributions are most welcome!</p>

<h1>
<a name="using-gitflow" class="anchor" href="#using-gitflow"><span class="octicon octicon-link"></span></a>Using GitFlow</h1>

<p>To contribute, simply submit a "Pull request" via GitHub.</p>

<p>We use GitFlow as a branching model and SemVer for versioning.</p>

<ul>
<li>When you submit a "Pull request" we require all changes to be squashed.</li>
<li>We never merge more than one commit at a time. All the n commits on your feature branch must be squashed.</li>
<li>We won't look at the pull request until Travis CI says the tests pass, make sure tests go well.</li>
</ul><h1>
<a name="scala-style-guidelines" class="anchor" href="#scala-style-guidelines"><span class="octicon octicon-link"></span></a>Scala Style Guidelines</h1>

<p>In spirit, we follow the <a href="http://twitter.github.io/effectivescala/">Twitter Scala Style Guidelines</a>.
We will reject your pull request if it doesn't meet code standards, but we'll happily give you a hand to get it right.</p>

<p>Some of the things that will make us seriously frown:</p>

<ul>
<li>Blocking when you don't have to. It just makes our eyes hurt when we see useless blocking.</li>
<li>Testing should be thread safe and fully async, use <code>ParallelTestExecution</code> if you want to show off.</li>
<li>Use the common patterns you already see here, we've done a lot of work to make it easy.</li>
<li>Don't randomly import stuff. We are very big on alphabetized clean imports.</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/websudosuk">websudosuk</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>